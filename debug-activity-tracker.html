<!DOCTYPE html>
<html>
<head>
    <title>Debug Activity Tracker</title>
</head>
<body>
    <h1>Debug Activity Tracker</h1>
    <div id="debug-output"></div>
    
    <script src="../assets/js/components/activity-tracker.js"></script>
    <script>
        const debugDiv = document.getElementById('debug-output');
        
        // Test 1: Check if ActivityTracker class exists
        if (typeof ActivityTracker !== 'undefined') {
            debugDiv.innerHTML += '<p>✅ ActivityTracker class loaded</p>';
            
            // Test 2: Try to create instance
            try {
                const tracker = new ActivityTracker(429, 'viewer');
                debugDiv.innerHTML += '<p>✅ ActivityTracker instance created</p>';
            } catch (error) {
                debugDiv.innerHTML += '<p>❌ Error creating ActivityTracker: ' + error.message + '</p>';
            }
        } else {
            debugDiv.innerHTML += '<p>❌ ActivityTracker class not found</p>';
        }
        
        // Test 3: Check API endpoint manually with detailed error handling
        debugDiv.innerHTML += '<p>Testing API manually...</p>';
        
        fetch('api/get_activity_feed.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                application_id: 429,
                filters: {}
            })
        })
        .then(response => {
            debugDiv.innerHTML += `<p>Response status: ${response.status}</p>`;
            debugDiv.innerHTML += `<p>Response headers: ${response.headers.get('content-type')}</p>`;
            
            return response.text(); // Get as text first to see raw response
        })
        .then(text => {
            debugDiv.innerHTML += `<p>Raw response: <pre>${text}</pre></p>`;
            
            try {
                const data = JSON.parse(text);
                if (data.success) {
                    debugDiv.innerHTML += '<p>✅ API call successful, got ' + data.activities.length + ' activities</p>';
                } else {
                    debugDiv.innerHTML += '<p>❌ API error: ' + data.error + '</p>';
                }
            } catch (parseError) {
                debugDiv.innerHTML += '<p>❌ JSON parse error: ' + parseError.message + '</p>';
            }
        })
        .catch(error => {
            debugDiv.innerHTML += '<p>❌ API call failed: ' + error.message + '</p>';
        });
    </script>
</body>
</html>
